<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex/" /><link rel="search" title="Search" href="../search/" /><link rel="next" title="Changelog" href="../changelog/" /><link rel="prev" title="Rationale" href="../rationale/" />
        <link rel="canonical" href="https://mcbeet.dev/overview.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>General overview - Beet documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mudkip_furo.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../"><div class="brand">Beet documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/beet_logo.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../rationale/">Rationale</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">General overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/mcbeet/beet">GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/beet">PyPI Package</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="general-overview">
<h1>General overview<a class="headerlink" href="#general-overview" title="Permalink to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">beet</span></code> project tries to provide consistent abstractions that work well together. A lot of care goes into leveraging existing patterns and intuitions to make the API as familiar as possible.</p>
<p>To keep the API surface manageable, abstractions are designed to provide orthogonal functionality. When things happen to fit into each other it's generally not an accident.</p>
<section id="data-packs-and-resource-packs">
<h2>Data packs and resource packs<a class="headerlink" href="#data-packs-and-resource-packs" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">beet</span></code> library allows you to work with data packs and resource packs at a high level. Data pack and resource pack objects are fast and flexible primitives that make it easy inspect, generate, merge and transform files, and perform bulk operations.</p>
<p>Data packs and resource packs are identical in nature and only differ in the types of resources they can contain. As a result, <code class="docutils literal notranslate"><span class="pre">beet</span></code> derives the concrete <code class="docutils literal notranslate"><span class="pre">DataPack</span></code> and <code class="docutils literal notranslate"><span class="pre">ResourcePack</span></code> classes from a generic <code class="docutils literal notranslate"><span class="pre">Pack</span></code> definition. It's the shared base class that's responsible for implementing all the operations that we'll be discussing in the next sections.</p>
<section id="object-hierarchy">
<h3>Object hierarchy<a class="headerlink" href="#object-hierarchy" title="Permalink to this heading">#</a></h3>
<p>Data packs are dict-like objects holding a collection of namespaces. Each key maps the name of the namespace to a <code class="docutils literal notranslate"><span class="pre">Namespace</span></code> instance that contains all the files within the namespace. Namespaces are created automatically and you shouldn't need to create them manually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">DataPack</span>

<span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>
<span class="n">demo_namespace</span> <span class="o">=</span> <span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo&quot;</span><span class="p">]</span>
<span class="n">demo_namespace</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataPackNamespace()
</pre></div>
</div>
</div>
</div>
<p>Namespaces themselves are also dict-like objects. Files inside namespaces are organized into homogeneous containers. Each key maps a file type to the associated file container that contains all the files of the given type within the namespace.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Function</span>

<span class="n">demo_functions</span> <span class="o">=</span> <span class="n">demo_namespace</span><span class="p">[</span><span class="n">Function</span><span class="p">]</span>
<span class="n">demo_functions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NamespaceContainer(keys=[])
</pre></div>
</div>
</div>
</div>
<p>These namespace containers are dict-like objects as well. Each key corresponds to a file path from the root directory of the container and maps to the associated file instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_functions</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">])</span>
<span class="n">demo_functions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NamespaceContainer(keys=[&#39;foo&#39;])
</pre></div>
</div>
</div>
</div>
<p>If you're already familiar with data packs, the overall structure of the object hierarchy shouldn't be surprising as it directly maps to the filesystem representation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;demo&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">Function</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">])</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Namespace containers are also available through attribute access. This is usually the syntax you'll be looking for as it's a bit more readable and provides better autocompletion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_namespace</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">demo_namespace</span><span class="p">[</span><span class="n">Function</span><span class="p">][</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>You can even omit the container entirely when adding files to the namespace. The namespace will dispatch the file to the appropriate container automatically depending on its type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_namespace</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say world&quot;</span><span class="p">])</span>
<span class="n">demo_namespace</span><span class="o">.</span><span class="n">functions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NamespaceContainer(keys=[&#39;foo&#39;, &#39;bar&#39;])
</pre></div>
</div>
</div>
</div>
</section>
<section id="resource-locations">
<h3>Resource locations<a class="headerlink" href="#resource-locations" title="Permalink to this heading">#</a></h3>
<p>The object hierarchy is a 1-to-1 representation that lets you work with data packs as pure Python objects. However, it can be a bit tedious to navigate depending on what you're trying to do. Most of the time, it's easier to reason about files in the data pack with their namespaced location, to reflect the way we interact with them in-game.</p>
<p>Data pack objects let you access files in a single lookup with proxies that expose a namespaced view of all the files of a specific type over all the namespaces in the data pack.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>

<span class="n">pack</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">()</span>
<span class="n">pack</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Proxy attributes are always in sync with the underlying namespaces. You can also omit the attribute when adding files to data packs. The data pack object will dispatch the file to the appropriate proxy depending on its type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo:bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">()</span>
<span class="n">pack</span><span class="o">.</span><span class="n">functions</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;demo:foo&quot;</span><span class="p">:</span> <span class="n">Function</span><span class="p">(),</span>
    <span class="s2">&quot;demo:bar&quot;</span><span class="p">:</span> <span class="n">Function</span><span class="p">(),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="extra-files">
<h3>Extra files<a class="headerlink" href="#extra-files" title="Permalink to this heading">#</a></h3>
<p>Unfortunately, data packs and resource packs aren't limited to neatly namespaced files and can contain extra files at the pack level and at the namespace level. Still, the <code class="docutils literal notranslate"><span class="pre">beet</span></code> library handles extra files as first-class citizens. In fact, <code class="docutils literal notranslate"><span class="pre">pack.mcmeta</span></code> and <code class="docutils literal notranslate"><span class="pre">pack.png</span></code> are both handled through this mechanism.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">JsonFile</span>

<span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>

<span class="n">pack</span><span class="o">.</span><span class="n">extra</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s2">&quot;pack.mcmeta&quot;</span><span class="p">:</span> <span class="n">JsonFile</span><span class="p">({</span><span class="s2">&quot;pack&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;pack_format&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}})</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">extra</span></code> attribute maps filenames to their respective file handles. To make it easier to access, the <code class="docutils literal notranslate"><span class="pre">pack.mcmeta</span></code> file is also directly pinned to the data pack instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span><span class="o">.</span><span class="n">mcmeta</span> <span class="ow">is</span> <span class="n">pack</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;pack.mcmeta&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pack.png</span></code> file works exactly the same. It's pinned to the <code class="docutils literal notranslate"><span class="pre">icon</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">PngFile</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">pack</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="n">PngFile</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="s2">&quot;red&quot;</span><span class="p">))</span>
<span class="n">pack</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;pack.png&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2d81922014cd573a32625702af1389ac98166717eeaf573416b868980fb6dcc6.png" src="../_images/2d81922014cd573a32625702af1389ac98166717eeaf573416b868980fb6dcc6.png" />
</div>
</div>
<p>For extra files at the namespace level we can look at the <code class="docutils literal notranslate"><span class="pre">sounds.json</span></code> file in resource packs. The file is pinned to the <code class="docutils literal notranslate"><span class="pre">sound_config</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">ResourcePack</span><span class="p">,</span> <span class="n">SoundConfig</span>

<span class="n">pack</span> <span class="o">=</span> <span class="n">ResourcePack</span><span class="p">()</span>

<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;minecraft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sound_config</span> <span class="o">=</span> <span class="n">SoundConfig</span><span class="p">()</span>
<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;minecraft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sound_config</span> <span class="ow">is</span> <span class="n">pack</span><span class="p">[</span><span class="s2">&quot;minecraft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;sounds.json&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Extra files are loaded according to the schema returned by the <code class="docutils literal notranslate"><span class="pre">get_extra_info</span></code> function. The returned dictionary tells the code that loads the data pack or the resource pack what files it should be looking for in addition to namespaced files, and how to load them depending on the associated type. You can add arbitrary files to the <code class="docutils literal notranslate"><span class="pre">extra</span></code> container when saving.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DataPack</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;pack.mcmeta&#39;: beet.library.base.Mcmeta, &#39;pack.png&#39;: beet.core.file.PngFile}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">ResourcePackNamespace</span>

<span class="n">ResourcePackNamespace</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;sounds.json&#39;: beet.library.resource_pack.SoundConfig}
</pre></div>
</div>
</div>
</div>
</section>
<section id="mcmeta-accessors">
<h3>Mcmeta accessors<a class="headerlink" href="#mcmeta-accessors" title="Permalink to this heading">#</a></h3>
<p>Data pack metadata is stored in the <code class="docutils literal notranslate"><span class="pre">pack.mcmeta</span></code> file in the <code class="docutils literal notranslate"><span class="pre">extra</span></code> container. The file is pinned to the <code class="docutils literal notranslate"><span class="pre">mcmeta</span></code> attribute, but to make things even more convenient data pack objects let you access the description and the pack format directly through pinned attributes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>

<span class="n">pack</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;My awesome pack&quot;</span>
<span class="n">pack</span><span class="o">.</span><span class="n">pack_format</span> <span class="o">=</span> <span class="mi">42</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pack</span><span class="o">.</span><span class="n">mcmeta</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;pack&quot;: {
    &quot;pack_format&quot;: 42,
    &quot;description&quot;: &quot;My awesome pack&quot;
  }
}
</pre></div>
</div>
</div>
</div>
<p>With resource packs you can use the pinned <code class="docutils literal notranslate"><span class="pre">language_config</span></code> attribute to register custom languages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Language</span>

<span class="n">pack</span> <span class="o">=</span> <span class="n">ResourcePack</span><span class="p">()</span>

<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;minecraft:custom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;menu.singleplayer&quot;</span><span class="p">:</span> <span class="s2">&quot;Modified singleplayer button&quot;</span><span class="p">})</span>
<span class="n">pack</span><span class="o">.</span><span class="n">language_config</span><span class="p">[</span><span class="s2">&quot;custom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Custom&quot;</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;Custom&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bidirectional&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pack</span><span class="o">.</span><span class="n">mcmeta</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;pack&quot;: {
    &quot;pack_format&quot;: 32,
    &quot;description&quot;: &quot;&quot;
  },
  &quot;language&quot;: {
    &quot;custom&quot;: {
      &quot;name&quot;: &quot;Custom&quot;,
      &quot;region&quot;: &quot;Custom&quot;,
      &quot;bidirectional&quot;: false
    }
  }
}
</pre></div>
</div>
</div>
</div>
</section>
<section id="namespace-binding-callbacks">
<h3>Namespace binding callbacks<a class="headerlink" href="#namespace-binding-callbacks" title="Permalink to this heading">#</a></h3>
<p>Data packs and resource packs feature certain types of files that have a special kind of relationship and that are often created together. One example would be functions and function tags. Namespaced files have a binding callback that can run arbitrary code when they're added to data packs. For example the <code class="docutils literal notranslate"><span class="pre">Function</span></code> constructor allows you to specify a list of function tags that will be associated with the function once it's added to the data pack.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">FunctionTag</span>

<span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>
<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:tick&quot;</span><span class="p">])</span>

<span class="n">pack</span><span class="o">.</span><span class="n">function_tags</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;minecraft:tick&quot;</span><span class="p">:</span> <span class="n">FunctionTag</span><span class="p">({</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]}),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>The same thing works with textures and texture mcmeta in resource packs. Sound files can also automatically register themselves in <code class="docutils literal notranslate"><span class="pre">sounds.json</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Texture</span><span class="p">,</span> <span class="n">TextureMcmeta</span>
<span class="kn">from</span> <span class="nn">PIL.ImageDraw</span> <span class="kn">import</span> <span class="n">Draw</span>

<span class="n">pack</span> <span class="o">=</span> <span class="n">ResourcePack</span><span class="p">()</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;minecraft:block/dirt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mcmeta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;animation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frametime&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}})</span>

<span class="n">pack</span><span class="o">.</span><span class="n">textures_mcmeta</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;minecraft:block/dirt&quot;</span><span class="p">:</span> <span class="n">TextureMcmeta</span><span class="p">({</span><span class="s2">&quot;animation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frametime&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}}),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>You can also create files with a custom <code class="docutils literal notranslate"><span class="pre">on_bind</span></code> callback.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_bind</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Function</span><span class="p">,</span> <span class="n">pack</span><span class="p">:</span> <span class="n">DataPack</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pack</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">],</span> <span class="n">on_bind</span><span class="o">=</span><span class="n">on_bind</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Function([&#39;say hello&#39;])
DataPack(name=None, description=&#39;&#39;, pack_format=41)
demo:foo
</pre></div>
</div>
</div>
</div>
</section>
<section id="merging">
<h3>Merging<a class="headerlink" href="#merging" title="Permalink to this heading">#</a></h3>
<p>Because all the data stored in data packs is ultimately represented by file instances, <code class="docutils literal notranslate"><span class="pre">beet</span></code> can implement a very straight-forward merging strategy that lets conflicting files decide if they should overwrite or merge with existing ones. For example, tag files will be merged together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>
<span class="n">p1</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:tick&quot;</span><span class="p">])</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>
<span class="n">p2</span><span class="p">[</span><span class="s2">&quot;demo:bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say world&quot;</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:tick&quot;</span><span class="p">])</span>

<span class="n">p1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

<span class="nb">dict</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;demo:foo&quot;</span><span class="p">:</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;demo:bar&quot;</span><span class="p">:</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say world&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;minecraft:tick&quot;</span><span class="p">:</span> <span class="n">FunctionTag</span><span class="p">({</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">,</span> <span class="s2">&quot;demo:bar&quot;</span><span class="p">]}),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">p2</span><span class="p">[</span><span class="s2">&quot;demo:bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say world&quot;</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:tick&quot;</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">p1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="nb">dict</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="s2">&quot;demo:foo&quot;</span><span class="p">:</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">]),</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="s2">&quot;demo:bar&quot;</span><span class="p">:</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say world&quot;</span><span class="p">]),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="s2">&quot;minecraft:tick&quot;</span><span class="p">:</span> <span class="n">FunctionTag</span><span class="p">({</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">,</span> <span class="s2">&quot;demo:bar&quot;</span><span class="p">]}),</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">}</span>

<span class="ne">AttributeError</span>: &#39;DataPack&#39; object has no attribute &#39;content&#39;
</pre></div>
</div>
</div>
</div>
<p>In resource packs, conflicting languages will preserve translations from both files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span> <span class="o">=</span> <span class="n">ResourcePack</span><span class="p">()</span>
<span class="n">p1</span><span class="p">[</span><span class="s2">&quot;minecraft:custom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;demo.foo&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">})</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">ResourcePack</span><span class="p">()</span>
<span class="n">p2</span><span class="p">[</span><span class="s2">&quot;minecraft:custom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;demo.bar&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">})</span>

<span class="n">p1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">languages</span><span class="p">[</span><span class="s2">&quot;minecraft:custom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;demo.foo&quot;: &quot;hello&quot;,
  &quot;demo.bar&quot;: &quot;world&quot;
}
</pre></div>
</div>
</div>
</div>
</section>
<section id="matching-key-patterns">
<h3>Matching key patterns<a class="headerlink" href="#matching-key-patterns" title="Permalink to this heading">#</a></h3>
<p>The object hierarchy that represents data packs and resource packs contains dict-like objects that have a few extra utilities compared to regular Python dictionaries. Data packs, namespace containers and proxies are all dict-like objects with string keys that expose a <code class="docutils literal notranslate"><span class="pre">match</span></code> method that returns a set of all the keys matching the given patterns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">()</span>
<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">])</span>
<span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo:bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say world&quot;</span><span class="p">])</span>

<span class="n">pack</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;d*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;demo&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span><span class="p">[</span><span class="s2">&quot;demo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;f*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;foo&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;demo:*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;demo:bar&#39;, &#39;demo:foo&#39;}
</pre></div>
</div>
</div>
</div>
<p>You can specify multiple patterns. The exclamation mark lets you invert a pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;demo:*&quot;</span><span class="p">,</span> <span class="s2">&quot;!demo:foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;demo:bar&#39;}
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="file-handles">
<h2>File handles<a class="headerlink" href="#file-handles" title="Permalink to this heading">#</a></h2>
<p>The core <code class="docutils literal notranslate"><span class="pre">beet</span></code> file handles make all the interactions with the filesystem lazy and as efficient as possible. They're responsible for exposing files in their serialized or deserialized state transparently and avoiding deserialization entirely whenever possible. This allows <code class="docutils literal notranslate"><span class="pre">beet</span></code> to load data packs and resource packs with thousands of files instantly.</p>
<section id="text-files-and-binary-files">
<h3>Text files and binary files<a class="headerlink" href="#text-files-and-binary-files" title="Permalink to this heading">#</a></h3>
<p>The implementation defines a base <code class="docutils literal notranslate"><span class="pre">File</span></code> class that's generic over the types of its serialized and deserialized representation. Files that inherit from <code class="docutils literal notranslate"><span class="pre">TextFileBase</span></code> store their serialized content as strings while files that inherit from <code class="docutils literal notranslate"><span class="pre">BinaryFileBase</span></code> store their serialized content as bytes. All concrete file types are then derived from one or the other. The most straight-forward concrete file types are <code class="docutils literal notranslate"><span class="pre">TextFile</span></code> and <code class="docutils literal notranslate"><span class="pre">BinaryFile</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">TextFile</span>

<span class="n">TextFile</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TextFile(&#39;hello&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">BinaryFile</span>

<span class="n">BinaryFile</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x01\x02\x03</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BinaryFile(b&#39;\x00\x01\x02\x03&#39;)
</pre></div>
</div>
</div>
</div>
<p>You can create files by providing the serialized or deserialized content to the constructor, or specifying a source path to an existing file. <code class="docutils literal notranslate"><span class="pre">TextFile</span></code> and <code class="docutils literal notranslate"><span class="pre">BinaryFile</span></code> are a bit special though because their serialized and deserialized state are identical.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span> <span class="o">=</span> <span class="n">TextFile</span><span class="p">(</span><span class="n">source_path</span><span class="o">=</span><span class="s2">&quot;../examples/load_basic/beet.json&quot;</span><span class="p">)</span>
<span class="n">handle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TextFile(source_path=&#39;../examples/load_basic/beet.json&#39;)
</pre></div>
</div>
</div>
</div>
<p>Note that this didn't perform any filesystem operation. The file handle is still in an unloaded state. Accessing the content in one way or another will load the file and discard the source path.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">handle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;data_pack&quot;: {
    &quot;load&quot;: [&quot;src&quot;]
  }
}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TextFile(&#39;{\n  &quot;data_pack&quot;: {\n    &quot;load&quot;: [&quot;src&quot;]\n  }\n}\n&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="file-states">
<h3>File states<a class="headerlink" href="#file-states" title="Permalink to this heading">#</a></h3>
<p>File handles can be in three distinct states:</p>
<ul>
<li><p>Unloaded</p>
<p>Files with a source path are unloaded. You can use the <code class="docutils literal notranslate"><span class="pre">ensure_source_path()</span></code> method to make sure that files are in an unloaded state and retrieve the source path.</p>
</li>
<li><p>Serialized</p>
<p>Files with plain string or bytes content are treated as serialized. You can use the <code class="docutils literal notranslate"><span class="pre">ensure_serialized()</span></code> method to get the serialized content of the file no matter the state it's currently in. Text files let you access the string content through the <code class="docutils literal notranslate"><span class="pre">text</span></code> attribute and binary files let you access the raw bytes through the <code class="docutils literal notranslate"><span class="pre">blob</span></code> attribute.</p>
</li>
<li><p>Deserialized</p>
<p>Files with a content that's different from a plain string or bytes are treated as deserialized. You can use the <code class="docutils literal notranslate"><span class="pre">ensure_deserialized()</span></code> method to get the deserialized content of the file no matter the state it's currently in. Classes deriving from <code class="docutils literal notranslate"><span class="pre">TextFile</span></code> and <code class="docutils literal notranslate"><span class="pre">BinaryFile</span></code> will expose the most suited and practical deserialized representation depending on the type of file.</p>
</li>
</ul>
<p>Most of the time, code that works with files doesn't need to know about the state it's currently in. If the file is already deserialized then accessing the deserialized representation will simply return the current content of the file, otherwise <code class="docutils literal notranslate"><span class="pre">beet</span></code> will transparently load the file if necessary and turn the string or bytes into the deserialized representation. The same thing happens when trying to access the string or bytes content. If the file is not loaded then <code class="docutils literal notranslate"><span class="pre">beet</span></code> will transparently load it on the fly and if the file is in its deserialized state it will automatically turn it into its serialized representation.</p>
<p>The different states make it possible to optimize various operations. For instance, dumping an unloaded file to the filesystem results in a native file copy operation, so if you're shuffling files around in a data pack you're not incurring extra loading and parsing costs by using the provided abstractions. Similarly, if you're using <code class="docutils literal notranslate"><span class="pre">beet</span></code> to zip a data pack the file handles won't needlessly turn any of the files into their deserialized representation. Another example would be equality checks. If two files are unloaded and point to the same source path they're considered equal.</p>
</section>
<section id="json-files">
<h3>Json files<a class="headerlink" href="#json-files" title="Permalink to this heading">#</a></h3>
<p>With the <code class="docutils literal notranslate"><span class="pre">JsonFile</span></code> class we can play around and see the differences between the unloaded, serialized, and deserialized states.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">JsonFile</span>

<span class="n">handle</span> <span class="o">=</span> <span class="n">JsonFile</span><span class="p">(</span><span class="n">source_path</span><span class="o">=</span><span class="s2">&quot;../examples/load_basic/beet.json&quot;</span><span class="p">)</span>
<span class="n">handle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>JsonFile(source_path=&#39;../examples/load_basic/beet.json&#39;)
</pre></div>
</div>
</div>
</div>
<p>The file is currently unloaded. By accessing the <code class="docutils literal notranslate"><span class="pre">text</span></code> attribute, which is the same as calling the <code class="docutils literal notranslate"><span class="pre">ensure_serialized()</span></code> method, <code class="docutils literal notranslate"><span class="pre">beet</span></code> will load the file and return the string content.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">handle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;data_pack&quot;: {
    &quot;load&quot;: [&quot;src&quot;]
  }
}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>JsonFile(&#39;{\n  &quot;data_pack&quot;: {\n    &quot;load&quot;: [&quot;src&quot;]\n  }\n}\n&#39;)
</pre></div>
</div>
</div>
</div>
<p>We can see that now the content of the file holds the string representing the json file. Json files expose their deserialized content as a dictionary of plain Python objects. By accessing the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute, which is the same as calling the <code class="docutils literal notranslate"><span class="pre">ensure_deserialized()</span></code> method, <code class="docutils literal notranslate"><span class="pre">beet</span></code> will parse the json and return the deserialized content.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">handle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_pack&quot;</span><span class="p">][</span><span class="s2">&quot;load&quot;</span><span class="p">]</span>
<span class="n">handle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>JsonFile({&#39;data_pack&#39;: {}})
</pre></div>
</div>
</div>
</div>
<p>Now the file is in its deserialized state, and any further code accessing the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute will be able to operate directly on the parsed dictionary. However, accessing the <code class="docutils literal notranslate"><span class="pre">text</span></code> attribute will transform the file into its serialized state again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">handle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;data_pack&quot;: {}
}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>JsonFile(&#39;{\n  &quot;data_pack&quot;: {}\n}\n&#39;)
</pre></div>
</div>
</div>
</div>
<p>The different states aren't something you explicitly need to worry about in code that works with files but it's good to keep in mind that it doesn't play well with weird access patterns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_pack&quot;</span><span class="p">][</span><span class="s2">&quot;pack_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_pack&quot;</span><span class="p">][</span><span class="s2">&quot;pack_format&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;data_pack&quot;: {
    &quot;pack_format&quot;: 1
  }
}

{
  &quot;data_pack&quot;: {
    &quot;pack_format&quot;: 2
  }
}

{
  &quot;data_pack&quot;: {
    &quot;pack_format&quot;: 3
  }
}
</pre></div>
</div>
</div>
</div>
<p>As you could've guessed, this kind of code is pretty problematic because even though it doesn't look like there's much going on, each iteration of the loop actually ends up parsing and serializing json.</p>
</section>
<section id="png-files">
<h3>Png files<a class="headerlink" href="#png-files" title="Permalink to this heading">#</a></h3>
<p>Another example of files with really distinct unloaded, serialized and deserialized states are png files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">PngFile</span>

<span class="n">handle</span> <span class="o">=</span> <span class="n">PngFile</span><span class="p">(</span><span class="n">source_path</span><span class="o">=</span><span class="s2">&quot;../logo.png&quot;</span><span class="p">)</span>
<span class="n">handle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PngFile(source_path=&#39;../logo.png&#39;)
</pre></div>
</div>
</div>
</div>
<p>As usual, the file starts out unloaded. Because images are binary files, we need to access the <code class="docutils literal notranslate"><span class="pre">blob</span></code> attribute to get the serialized content.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span><span class="o">.</span><span class="n">blob</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b&#39;\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x80&#39;
</pre></div>
</div>
</div>
</div>
<p>Now the file is loaded and isn't linked to the original source file anymore.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span><span class="o">.</span><span class="n">source_path</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Accessing the <code class="docutils literal notranslate"><span class="pre">image</span></code> attribute will deserialize the file into a <code class="docutils literal notranslate"><span class="pre">PIL</span></code> image, which makes it possible to edit the image programmatically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
<span class="n">handle</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
<span class="n">handle</span><span class="o">.</span><span class="n">image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">File ~/work/beet/beet/.venv/lib/python3.10/site-packages/PIL/JpegImagePlugin.py:639,</span> in <span class="ni">_save</span><span class="nt">(im, fp, filename)</span>
<span class="g g-Whitespace">    </span><span class="mi">638</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">639</span>     <span class="n">rawmode</span> <span class="o">=</span> <span class="n">RAWMODE</span><span class="p">[</span><span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">640</span> <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">KeyError</span>: &#39;RGBA&#39;

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="nn">File ~/work/beet/beet/.venv/lib/python3.10/site-packages/PIL/Image.py:643,</span> in <span class="ni">Image._repr_image</span><span class="nt">(self, image_format, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">642</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">643</span>     <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">image_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">File ~/work/beet/beet/.venv/lib/python3.10/site-packages/PIL/Image.py:2413,</span> in <span class="ni">Image.save</span><span class="nt">(self, fp, format, **params)</span>
<span class="g g-Whitespace">   </span><span class="mi">2412</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2413</span>     <span class="n">save_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2414</span> <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>

<span class="nn">File ~/work/beet/beet/.venv/lib/python3.10/site-packages/PIL/JpegImagePlugin.py:642,</span> in <span class="ni">_save</span><span class="nt">(im, fp, filename)</span>
<span class="g g-Whitespace">    </span><span class="mi">641</span>     <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cannot write mode </span><span class="si">{</span><span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2"> as JPEG&quot;</span>
<span class="ne">--&gt; </span><span class="mi">642</span>     <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span> <span class="n">info</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">encoderinfo</span>

<span class="ne">OSError</span>: cannot write mode RGBA as JPEG

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">File ~/work/beet/beet/.venv/lib/python3.10/site-packages/IPython/core/formatters.py:344,</span> in <span class="ni">BaseFormatter.__call__</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span>     <span class="n">method</span> <span class="o">=</span> <span class="n">get_real_method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_method</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span>     <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">344</span>         <span class="k">return</span> <span class="n">method</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">345</span>     <span class="k">return</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">346</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File ~/work/beet/beet/.venv/lib/python3.10/site-packages/PIL/Image.py:661,</span> in <span class="ni">Image._repr_jpeg_</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">656</span> <span class="k">def</span> <span class="nf">_repr_jpeg_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;iPython display hook support for JPEG format.</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">659</span><span class="sd">     :returns: JPEG version of the image as bytes</span>
<span class="g g-Whitespace">    </span><span class="mi">660</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">661</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_image</span><span class="p">(</span><span class="s2">&quot;JPEG&quot;</span><span class="p">)</span>

<span class="nn">File ~/work/beet/beet/.venv/lib/python3.10/site-packages/PIL/Image.py:646,</span> in <span class="ni">Image._repr_image</span><span class="nt">(self, image_format, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">645</span>     <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Could not save to </span><span class="si">{</span><span class="n">image_format</span><span class="si">}</span><span class="s2"> for display&quot;</span>
<span class="ne">--&gt; </span><span class="mi">646</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">    </span><span class="mi">647</span> <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="ne">ValueError</span>: Could not save to JPEG for display
</pre></div>
</div>
<img alt="../_images/cee7865e5260b7c12142e34f2a7edeb1bcba0b0ac29060fa37c9cbacc3689018.png" src="../_images/cee7865e5260b7c12142e34f2a7edeb1bcba0b0ac29060fa37c9cbacc3689018.png" />
</div>
</div>
</section>
<section id="files-and-data-packs">
<h3>Files and data packs<a class="headerlink" href="#files-and-data-packs" title="Permalink to this heading">#</a></h3>
<p>The files used in data packs and resource packs are derived from the core file handles. For example, you can create function files from a source path, a string representing the content of the function, or a list of strings corresponding to the lines of the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span> <span class="o">=</span> <span class="n">DataPack</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;../examples/load_basic/src&quot;</span><span class="p">)</span>
<span class="n">pack</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Function(source_path=PosixPath(&#39;/home/runner/work/beet/beet/examples/load_basic/src/data/demo/functions/foo.mcfunction&#39;))
</pre></div>
</div>
</div>
</div>
<p>As you can see, when we load an unzipped data pack all the files remain in their unloaded state. The moment we start interacting with the content of the function <code class="docutils literal notranslate"><span class="pre">beet</span></code> will load the file automatically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;say bar&quot;</span><span class="p">)</span>
<span class="n">pack</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s2">&quot;demo:foo&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Function([&#39;say foo&#39;, &#39;say bar&#39;])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-toolchain">
<h2>The toolchain<a class="headerlink" href="#the-toolchain" title="Permalink to this heading">#</a></h2>
<p>In the previous sections we briefly introduced some of the operations that you can do with data packs and resource packs. For example, you can easily add generated resources to a data pack by writing a simple script that uses the previously mentioned APIs. The problem is that none of these scripts are likely to be reusable.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">beet</span></code> toolchain is a fully-fledged build system that lets you implement the behavior you need as plugins that can be composed with one another. It helps with making your code reusable and not just one-off scripts, and provides a cohesive developer experience.</p>
<p>The idea is that each plugin is a callable Python object that accepts a context that exposes a data pack and a resource pack. The toolchain initializes the context with an empty data pack and an empty resource pack, and then feeds it to the plugins one by one. When a plugin is called it can load and merge existing data packs into the context, inspect the various files, or generate resources programmatically. When all the plugins are done, the toolchain can then output the generated data pack or link it to a Minecraft world.</p>
<section id="plugins">
<h3>Plugins<a class="headerlink" href="#plugins" title="Permalink to this heading">#</a></h3>
<p>We're going to transform a simple script into a plugin to introduce the concept one step at a time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">DataPack</span><span class="p">,</span> <span class="n">Function</span>

<span class="k">with</span> <span class="n">DataPack</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;out/greeting_data_pack&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>If you download and run this script with the Python interpreter, it will create a data pack in a new &quot;out&quot; directory called &quot;greeting_data_pack&quot;. The script generates a function that says &quot;hello&quot; five times when the data pack is loaded.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree out
out
└── greeting_data_pack
    ├── data
    │   ├── greeting
    │   │   └── functions
    │   │       └── hello.mcfunction
    │   └── minecraft
    │       └── tags
    │           └── functions
    │               └── load.json
    └── pack.mcmeta

7 directories, 3 files
</pre></div>
</div>
<p>Now, let's say you want to be able to greet players like this in another data pack. The first thing to do would be to separate the logic in its own function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">DataPack</span><span class="p">,</span> <span class="n">Function</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">DataPack</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="n">DataPack</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;out/greeting_data_pack&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">add_greeting</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the script still does the same thing as before, but now if you wanted to create a second data pack you could use the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> function to add the same greeting to the second data pack.</p>
<p>It turns out that now that we have extracted the logic into a function that takes a data pack as input, we can easily turn it into a <code class="docutils literal notranslate"><span class="pre">beet</span></code> plugin.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Function</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;say hello&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>The plugin takes a <code class="docutils literal notranslate"><span class="pre">Context</span></code> object that lets you access the data pack with the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute. Implementing our logic as a plugin means that we no longer need to create the data pack ourselves and call the function manually. Instead, we can create a <code class="docutils literal notranslate"><span class="pre">beet.json</span></code> config file and let the toolchain create the data pack for us. The toolchain knows how to call our plugin on its own so we removed the rest of the code.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;greeting&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pipeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;my_plugins.add_greeting&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">name</span></code> option sets the name of the project to &quot;greeting&quot;. The <code class="docutils literal notranslate"><span class="pre">output</span></code> option tells the toolchain to output the generated data pack into a directory called &quot;out&quot;. The <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> option lets you specify the plugins that should be called when building the data pack. If you save the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin in a file called &quot;my_plugins.py&quot;, you'll be able to run the <code class="docutils literal notranslate"><span class="pre">beet</span></code> command to generate the data pack.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ beet
Building project...

Done!
</pre></div>
</div>
<p>We can see that again, this results in the exact same data pack as before, but with the added benefit that now we can potentially reuse our plugin in other projects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree out
out
└── greeting_data_pack
    ├── data
    │   ├── greeting
    │   │   └── functions
    │   │       └── hello.mcfunction
    │   └── minecraft
    │       └── tags
    │           └── functions
    │               └── load.json
    └── pack.mcmeta

7 directories, 3 files
</pre></div>
</div>
</section>
<section id="the-context-object">
<h3>The context object<a class="headerlink" href="#the-context-object" title="Permalink to this heading">#</a></h3>
<p>We've seen that plugins take a <code class="docutils literal notranslate"><span class="pre">Context</span></code> object as input, but what exactly is it? What can you do with it?</p>
<p>So far we know there's a <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute that holds a <code class="docutils literal notranslate"><span class="pre">DataPack</span></code> instance. This data pack starts out completely empty, and then as plugins get called, they can inspect the content of the data pack and change it. When the build ends the toolchain then outputs the resulting data pack in one way or another.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">assets</span></code> attribute holds a <code class="docutils literal notranslate"><span class="pre">ResourcePack</span></code> instance. It works exactly like the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute and plugins can generate assets that the toolchain outputs alongside the data pack at the end of the build. We can try this out by making the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin greet players in their own language.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Language</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:en_us&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">})</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:fr_fr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;bonjour&quot;</span><span class="p">})</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;tellraw @a {&quot;translate&quot;: &quot;greeting.hello&quot;}&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>We're using the <code class="docutils literal notranslate"><span class="pre">assets</span></code> attribute to add language files to the resource pack. We also changed the function to use the <code class="docutils literal notranslate"><span class="pre">tellraw</span></code> command to translate the message depending on the player's language.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree out
out
├── greeting_data_pack
│   ├── data
│   │   ├── greeting
│   │   │   └── functions
│   │   │       └── hello.mcfunction
│   │   └── minecraft
│   │       └── tags
│   │           └── functions
│   │               └── load.json
│   └── pack.mcmeta
└── greeting_resource_pack
    ├── assets
    │   └── minecraft
    │       └── lang
    │           ├── en_us.json
    │           └── fr_fr.json
    └── pack.mcmeta

11 directories, 6 files
</pre></div>
</div>
<p>After running the <code class="docutils literal notranslate"><span class="pre">beet</span></code> command we can see that the toolchain generated a resource pack called &quot;greeting_resource_pack&quot; in the output directory.</p>
<p>Now, let's say the translated message could be used on its own in another project that greets players differently. We can extract the code that adds the language files into its own plugin.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Language</span>

<span class="k">def</span> <span class="nf">add_greeting_translations</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:en_us&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">})</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:fr_fr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;bonjour&quot;</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;tellraw @a {&quot;translate&quot;: &quot;greeting.hello&quot;}&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin is now responsible for adding our translations to the generated resource pack. We can add it to the <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> option in the <code class="docutils literal notranslate"><span class="pre">beet.json</span></code> config file.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;greeting&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pipeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;my_plugins.add_greeting_translations&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;my_plugins.add_greeting&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The resulting data pack and resource pack didn't change, but now we're composing the behavior of two plugins together.</p>
<p>The basic idea behind the <code class="docutils literal notranslate"><span class="pre">Context</span></code> object is that it's responsible for holding the shared state that makes it possible for plugins to cooperate. In addition to the data pack and the resource pack, plugins can use the <code class="docutils literal notranslate"><span class="pre">Context</span></code> object to access a bunch of other things such as the caching and generator APIs, the template manager, background workers and pipeline metadata.</p>
<p>An example would be using the <code class="docutils literal notranslate"><span class="pre">meta</span></code> attribute to make the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin configurable. Right now it always shows the message five times but by using pipeline metadata we can configure how many repetitions we want right from the config file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Language</span>

<span class="k">def</span> <span class="nf">add_greeting_translations</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:en_us&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">})</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:fr_fr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;bonjour&quot;</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">greeting_count</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;greeting_count&quot;</span><span class="p">]</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;tellraw @a {&quot;translate&quot;: &quot;greeting.hello&quot;}&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">greeting_count</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Now in the config file we can use the <code class="docutils literal notranslate"><span class="pre">meta</span></code> option to specify the &quot;greeting_count&quot; used by the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;greeting&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pipeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;my_plugins.add_greeting_translations&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;my_plugins.add_greeting&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;greeting_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The generated data pack now shows the greeting seven times when the data pack is loaded.</p>
</section>
<section id="plugin-dependencies">
<h3>Plugin dependencies<a class="headerlink" href="#plugin-dependencies" title="Permalink to this heading">#</a></h3>
<p>You might have noticed that in the previous example, when we separated the code that adds the translations into its own plugin, we made it easy to introduce a potential bug.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin can be used on its own, it simply adds language files to the resource pack. However, the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin relies on being able to use the message defined in the language files. Now that the translations are in their own plugin, the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin can't be used on its own anymore in the <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> option.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;greeting&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pipeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;my_plugins.add_greeting&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;greeting_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If we forget to use <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> we won't see any output in-game. The <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin requires you to use <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> as well.</p>
<p>It's not always this trivial to keep track of plugin dependencies manually so the <code class="docutils literal notranslate"><span class="pre">Context</span></code> object provides a <code class="docutils literal notranslate"><span class="pre">require()</span></code> method that adds a given plugin to the pipeline if it hasn't already been called.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Language</span>

<span class="k">def</span> <span class="nf">add_greeting_translations</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:en_us&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">})</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft:fr_fr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="p">({</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">:</span> <span class="s2">&quot;bonjour&quot;</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">add_greeting_translations</span><span class="p">)</span>
    <span class="n">greeting_count</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;greeting_count&quot;</span><span class="p">]</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;tellraw @a {&quot;translate&quot;: &quot;greeting.hello&quot;}&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">greeting_count</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Now the resource pack gets generated again and the message properly shows up in-game. The <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin can still be used on its own if we want to use the translated message for something else, but using the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin will now make sure that the <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin has been called before adding the function that greets players.</p>
</section>
<section id="the-pipeline">
<h3>The pipeline<a class="headerlink" href="#the-pipeline" title="Permalink to this heading">#</a></h3>
<p>We've seen how plugins can cooperate with the <code class="docutils literal notranslate"><span class="pre">Context</span></code> object, and we just learned how to make plugins that depend on other plugins. In these sections we mentioned the pipeline a few times already but never actually explained what it is.</p>
<p>To put it simply, the pipeline is the thing that runs plugins. Plugins can only run once per pipeline. The pipeline can import plugins dynamically and knows when a plugin has already been executed. This means that if a plugin is required multiple times, it will still only be executed once.</p>
<p>One thing that we didn't experiment with until now is that plugins are actually wrapping each other, and not just being called sequentially. Each plugin in the pipeline surrounds the ones after, like layers. The last plugin in the pipeline is the innermost layer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌────────────────────────┐
│ Context initialization │
└─┬──────────────────────┘
  │
  │   ┌──────────────────────────────────────────────┐
  │   │ def add_greeting_translations(ctx: Context): │
  │   │     ...                                      │
  │   │   ┌─────────────────────────────────┐        │
  │   │   │ def add_greeting(ctx: Context): │        │
  │   │   │     ...                         │        │
  │   │   │                                 │        │
  └───┼───┼───► Entry phase ────────────────┼────────┼───► Exit phase
      │   │                                 │        │
      │   └─────────────────────────────────┘        │
      └──────────────────────────────────────────────┘
</pre></div>
</div>
<p>If we apply this to the example we've been using so far, <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> conceptually surrounds <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code>, because the <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin is required by <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code>.</p>
<p>The pipeline runs all plugins from the outermost layer until it reaches the innermost layer. Then the execution goes back through each plugin in reverse, like nested context managers. Because of this each plugin has an entry phase and an exit phase. Plugins can run code during the exit phase by using the <code class="docutils literal notranslate"><span class="pre">yield</span></code> statement to wait for the execution to come back, when all the dependent plugins are done.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Language</span>

<span class="k">def</span> <span class="nf">add_greeting_translations</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>                              <span class="c1"># [3]</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;greeting_translations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">yield</span>                                                                 <span class="c1"># [4]</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">translations</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;greeting_translations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   <span class="c1"># [6]</span>
        <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">translations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">languages</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;minecraft:</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">Language</span><span class="p">({</span><span class="sa">f</span><span class="s2">&quot;greeting.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})}</span>
            <span class="p">)</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>                                           <span class="c1"># [1]</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">add_greeting_translations</span><span class="p">)</span>                                <span class="c1"># [2]</span>
    <span class="n">greeting_count</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;greeting_count&quot;</span><span class="p">]</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;greeting_translations&quot;</span><span class="p">][</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>                        <span class="c1"># [5]</span>
        <span class="s2">&quot;en_us&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fr_fr&quot;</span><span class="p">:</span> <span class="s2">&quot;bonjour&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;tellraw @a {&quot;translate&quot;: &quot;greeting.hello&quot;}&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">greeting_count</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>To illustrate the idea, we made a few changes to the <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin. We now generate the language files depending on the messages added to the <code class="docutils literal notranslate"><span class="pre">greeting_translations</span></code> dictionary by dependent plugins. This definitely adds a lot of unnecessary complexity to our simple example, but you could imagine the pattern being useful on a larger scale.</p>
<p>Let's walk through the example step by step:</p>
<ol class="arabic simple">
<li><p>The pipeline first begins with <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> requires <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code>, so all the remaining code gets conceptually surrounded by <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code>.</p></li>
<li><p>The execution then jumps to <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> and the <code class="docutils literal notranslate"><span class="pre">greeting_translations</span></code> dictionary gets initialized.</p></li>
<li><p>Next, since the yield statement waits for dependent plugins to be done, the pipeline resumes the execution of the <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">add_greeting</span></code> plugin runs to completion and the <code class="docutils literal notranslate"><span class="pre">greeting_translations</span></code> dictionary now contains the message needed by the tellraw command.</p></li>
<li><p>All the plugins that require <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> are done so the execution resumes and the plugin generates language files according to the updated <code class="docutils literal notranslate"><span class="pre">greeting_translations</span></code> dictionary.</p></li>
</ol>
<p>This is a pretty advanced topic. Most plugins don't actually need to care about any of this, but it can be helpful to remember that the <code class="docutils literal notranslate"><span class="pre">yield</span></code> statement lets you wait for dependent plugins to be done.</p>
</section>
<section id="service-injection">
<h3>Service injection<a class="headerlink" href="#service-injection" title="Permalink to this heading">#</a></h3>
<p>Our previous attempt at generalizing the plugin responsible for generating language files helped us introduce the <code class="docutils literal notranslate"><span class="pre">yield</span></code> statement, but it's ultimately not that much of an improvement compared to dealing with the language files directly. The API is also kind of implicit so it would be nice if we could package everything into a proper abstraction.</p>
<p>The context object acts as a very basic service container. The <code class="docutils literal notranslate"><span class="pre">inject()</span></code> method lets you instantiate and retrieve service objects that live for the duration of the current pipeline.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Function</span>

<span class="k">def</span> <span class="nf">add_greeting</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
    <span class="n">i18n</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">Internationalization</span><span class="p">)</span>
    <span class="n">i18n</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;greeting.hello&quot;</span><span class="p">,</span> <span class="n">en_us</span><span class="o">=</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="n">fr_fr</span><span class="o">=</span><span class="s2">&quot;bonjour&quot;</span><span class="p">)</span>

    <span class="n">greeting_count</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;greeting_count&quot;</span><span class="p">]</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;greeting:hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;tellraw @a {&quot;translate&quot;: &quot;greeting.hello&quot;}&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">greeting_count</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;minecraft:load&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Let's try to come up with an <code class="docutils literal notranslate"><span class="pre">Internationalization</span></code> service that can be used to create translated messages. We removed the <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin and instead of having to populate some arbitrary context metadata, we're going to implement a more explicit <code class="docutils literal notranslate"><span class="pre">set()</span></code> method for creating translated messages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">DefaultDict</span>

<span class="kn">from</span> <span class="nn">beet</span> <span class="kn">import</span> <span class="n">Language</span>

<span class="k">class</span> <span class="nc">Internationalization</span><span class="p">:</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Language</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">languages</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Language</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_translations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_translations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
        <span class="k">yield</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s2">&quot;minecraft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">languages</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
</pre></div>
</div>
<p>Services are instantiated when they're injected for the first time with the context object as argument. The <code class="docutils literal notranslate"><span class="pre">set()</span></code> method adds translated messages to the language files stored in the <code class="docutils literal notranslate"><span class="pre">languages</span></code> attribute. When the <code class="docutils literal notranslate"><span class="pre">Internationalization</span></code> service is created, the constructor requires its <code class="docutils literal notranslate"><span class="pre">add_translations</span></code> method as a plugin. The plugin uses the <code class="docutils literal notranslate"><span class="pre">yield</span></code> statement to wait for all the plugins using the <code class="docutils literal notranslate"><span class="pre">Internationalization</span></code> service to be done and then merges the generated language files.</p>
<p>In general, service injection makes it possible to package context operations into proper abstractions. With the <code class="docutils literal notranslate"><span class="pre">inject()</span></code> method we refactored the awkward <code class="docutils literal notranslate"><span class="pre">add_greeting_translations</span></code> plugin into a decoupled, strongly-typed <code class="docutils literal notranslate"><span class="pre">Internationalization</span></code> service with an explicit API.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../changelog/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Changelog</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../rationale/">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Rationale</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">General overview</a><ul>
<li><a class="reference internal" href="#data-packs-and-resource-packs">Data packs and resource packs</a><ul>
<li><a class="reference internal" href="#object-hierarchy">Object hierarchy</a></li>
<li><a class="reference internal" href="#resource-locations">Resource locations</a></li>
<li><a class="reference internal" href="#extra-files">Extra files</a></li>
<li><a class="reference internal" href="#mcmeta-accessors">Mcmeta accessors</a></li>
<li><a class="reference internal" href="#namespace-binding-callbacks">Namespace binding callbacks</a></li>
<li><a class="reference internal" href="#merging">Merging</a></li>
<li><a class="reference internal" href="#matching-key-patterns">Matching key patterns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file-handles">File handles</a><ul>
<li><a class="reference internal" href="#text-files-and-binary-files">Text files and binary files</a></li>
<li><a class="reference internal" href="#file-states">File states</a></li>
<li><a class="reference internal" href="#json-files">Json files</a></li>
<li><a class="reference internal" href="#png-files">Png files</a></li>
<li><a class="reference internal" href="#files-and-data-packs">Files and data packs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-toolchain">The toolchain</a><ul>
<li><a class="reference internal" href="#plugins">Plugins</a></li>
<li><a class="reference internal" href="#the-context-object">The context object</a></li>
<li><a class="reference internal" href="#plugin-dependencies">Plugin dependencies</a></li>
<li><a class="reference internal" href="#the-pipeline">The pipeline</a></li>
<li><a class="reference internal" href="#service-injection">Service injection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>